好的，我们继续进入《计算机组成原理》第三章的第五部分，根据您提供的《第三章 模型机的微程序控制器（五）》的内容，我将为您梳理和讲解这一部分的核心知识点。

---

### **第三章 模型机的微程序控制器 (第五部分) 知识讲解**

在上一章中，我们学习了**组合逻辑控制器**，它速度快但设计复杂且难以修改。本部分将介绍另一种主流的控制器设计方法——**微程序控制器**，它通过“存储程序”的思想，用“软件”的方式来解决“硬件”问题，极大地提高了控制器的灵活性。

#### **1. 基本概念及原理**

这是理解微程序控制器的基础。

*   **1.1 核心概念**：
    *   **微命令 (Micro-command)**：构成控制信号序列的最小单位，直接作用于部件或控制门电路。例如：`EMAR`、`R`、`CPPC`。
    *   **微操作 (Micro-operation)**：由微命令控制实现的最基本的操作。例如：打开地址总线三态门（`EMAR`）、将PC内容加1并打入PC（`PC+1→PC`）。
    *   **微周期 (Micro-cycle)**：从控制存储器中读取并执行一条微指令所需的时间。通常一个时钟周期就是一个微周期。
    *   **微指令 (Micro-instruction)**：每个微周期所需执行的微命令的集合。从硬件角度看，控制存储器（CM）的每个单元存放一条微指令。
    *   **微程序 (Micro-program)**：一系列微指令的有序集合。**一条机器指令**对应**一段微程序**，用于解释和执行这条机器指令。

*   **1.2 微程序控制的概念**：
    *   将控制器所需的微命令，以代码（微码）的形式编成微指令，存入一个由ROM构成的**控制存储器 (Control Memory, CM)** 中。
    *   将各种机器指令的操作分解为若干微操作序列。
    *   这种方法将**存储逻辑**和**程序技术**引入到了CPU的构成级，是“存储程序”思想在控制器设计中的体现。

#### **2. 微程序控制器组成及工作原理**

*   **2.1 硬件组成**（文档第9页框图）：
    *   **控制存储器 (CM)**：存放所有微程序的ROM。每个单元存放一条微指令。
    *   **微地址寄存器 (µAR)**：保存当前要读取的微指令在CM中的地址（微地址）。
    *   **微指令寄存器 (µIR)**：存放从CM中读出的微指令。它分为两部分：
        *   **微操作控制字段**：产生微命令的依据，相当于机器指令的操作码。
        *   **顺序控制字段**：产生后继微地址的依据，用于控制微程序的执行流程。
    *   **微地址形成电路**：根据当前微指令的顺序控制字段、当前微地址、转移条件等信息，计算出下一条微指令的地址。
    *   **译码器**：将µIR中的微操作控制字段译码，产生具体的微命令信号。
    *   **时序系统**：提供微周期的时钟信号。
    *   **IR、PSW、PC**：提供生成微命令所需的输入信息。

*   **2.2 工作原理**：
    1.  **取指**：CPU启动时，µAR被置为“取指微程序”的入口地址。从CM中读取第一条微指令，送入µIR。
    2.  **译码执行**：µIR的微操作控制字段经译码器产生微命令，控制CPU完成一步操作（如 `PC→MAR`）。
    3.  **形成后继地址**：µIR的顺序控制字段与µAR、状态信息等一起，通过微地址形成电路，计算出下一条微指令的地址，并送入µAR。
    4.  **循环**：重复步骤2和3，逐条执行“取指微程序”，直到指令被取出并送入IR。
    5.  **功能转移**：取指完成后，根据IR中机器指令的操作码，通过微地址形成电路，找到该指令对应的“功能微程序”的入口地址（初始微地址）。
    6.  **执行**：从入口地址开始，逐条执行该指令的微程序，完成指令规定的全部操作。

#### **3. 微指令的编码方式**

如何组织微指令中的微命令，直接影响控制器的效率和复杂度。

*   **3.1 直接控制法 (不译法)**：
    *   微指令中**控制字段的每一位**直接对应一个微命令。
    *   **优点**：简单直观，无需译码，执行速度快。
    *   **缺点**：微指令字长很长，因为有多少个微命令就需要多少位，导致控制存储器CM容量巨大，成本高。

*   **3.2 分段直接编译法 (显示编码)**：
    *   将微指令的控制字段**分成若干小字段（组）**。
    *   每个小字段通过一个译码器独立译码，定义一组互斥的微命令（即一个字段编码对应一种微命令）。
    *   **优点**：显著缩短了微指令字长，节省了CM空间。
    *   **缺点**：需要额外的译码电路，执行速度比直接控制法稍慢。

*   **3.3 分段间接编译法 (隐式编码)**：
    *   一个字段的含义不仅由其自身编码决定，还需要结合其他字段（或状态信息）来共同解释。
    *   这种编码方式更加紧凑，但逻辑关系复杂，设计难度高。

#### **4. 微程序的顺序控制方式**

如何确定下一条微指令的地址，是微程序控制器的关键。

*   **4.1 初始微地址的形成**：
    *   **取指微程序**：在指令周期开始时，CPU总是先执行“取指微程序”，其入口地址是固定的（如 `0`）。
    *   **功能转移**：取指完成后，根据IR中机器指令的**操作码**，通过微地址形成电路，找到该指令对应微程序的入口地址。
        *   **一级功能转移**：操作码直接作为微程序入口地址的一部分。
        *   **多级功能转移**：操作码经过多级译码或查找表（如PLA）得到入口地址。

*   **4.2 后继微地址的形成**：
    *   **增量方式**：后继微地址 = 当前微地址 + 1。适用于顺序执行的微指令。
    *   **断定方式 (下址字段法)**：微指令的**顺序控制字段**中直接包含了下一条微指令的地址。这种方式非常灵活，可以方便地实现微程序的跳转、循环和分支。

#### **5. 微指令格式**

*   **5.1 基本格式**：
    *   微指令通常分为**微操作控制字段**和**顺序控制字段**。
    *   根据数据通路结构，微操作控制字段可进一步细分为：**基本数据通路控制字段**、**访存控制字段**、**辅助控制字段**等。

*   **5.2 格式分类**：
    *   **垂直型微指令**：每条微指令只定义并执行一种基本操作（如一次数据传送）。类似于机器指令，功能单一。
    *   **水平型微指令**：每条微指令可以定义并行执行的多个基本操作（如同时 `M→IR` 和 `PC+1→PC`）。功能强大，执行效率高。
    *   **混合型微指令**：结合了垂直型和水平型的特点。

---

**小结**：
微程序控制器是计算机设计史上的一个重大进步。它将复杂的控制器设计转化为“编写微程序”的问题，通过**存储**和**程序**的方式，极大地提高了控制器的**规整性**和**灵活性**。虽然其执行速度通常略慢于组合逻辑控制器（因为有查CM的开销），但其**易于设计、调试和修改**的优点使其在现代处理器中得到了广泛应用。它完美地诠释了“用软件解决硬件问题”的工程思想。


---
---
```

```
---
---

# 关于这两控制器

## 最大区别：

**组合逻辑电路的微命令是及时算出来的，**

**微程序控制器直接从CM中拿去相应的微指令，然后一步一步执行里面的微命令。**

**完全正确！** 您这个总结非常精准，一语道破了两种控制器最本质的区别。

我们可以把您的这句话进一步展开和强化：

---

### **核心区别：微命令的“来源”与“产生方式”**

| 特性 | **组合逻辑控制器 (Hardwired)** | **微程序控制器 (Microprogrammed)** |
| :--- | :--- | :--- |
| **微命令来源** | **即时计算** (Real-time Computation) | **预先读取** (Pre-stored Fetch) |
| **产生方式** | 通过**组合逻辑电路**（门电路网络）根据当前的输入信号（指令、周期、节拍、状态）实时计算得出。 | 从**控制存储器 (CM)** 中读取一条**预存的微指令**，然后通过**译码器**将其“翻译”成一组微命令。 |
| **类比** | 像一个**心算高手**：看到题目（指令+时序），大脑（逻辑电路）瞬间心算出答案（微命令）。 | 像一个**查表员**：看到题目（指令+时序），去查一本厚厚的**答案手册**（控制存储器），找到对应的答案（微指令），然后照着念（译码执行）。 |
| **硬件基础** | **逻辑门** (AND, OR, NOT 等) 构成的复杂电路。 | **存储器** (ROM) + **地址寄存器** (µAR) + **指令寄存器** (µIR) + **译码器**。 |

---

### **深入解释您的总结**

1.  **“微程序控制器的微命令其实是读取的”**
    *   **“读取”** 是关键词。微命令不是“算”出来的，而是“找”出来的。
    *   控制器的工作流程是：**根据当前状态计算地址 → 从CM中读取微指令 → 译码微指令 → 输出微命令**。
    *   这个过程像查字典：你有一个单词（当前状态），你需要查它的意思（微命令），你必须先翻到正确的页码（微地址），然后读取那一页上的解释（微指令），最后理解它（译码）。
    *   **微程序**本身就是一系列预先编写好、存储在CM中的“操作指南”。

2.  **“电路逻辑控制器是即时算出来的”**
    *   **“即时计算”** 是关键词。没有存储、没有查表，只有逻辑运算。
    *   控制器是一个**纯组合逻辑电路**。它的输出（微命令）**完全且立即**由输入（指令、周期、节拍）决定，中间没有“存储-读取”的延迟。
    *   就像一个数学公式：`y = f(x)`。只要输入 `x`（当前状态），输出 `y`（微命令）就立刻通过电路的物理延迟后产生。
    *   这种“计算”是并行的、直接的，因此**速度非常快**。

---

### **一个形象的比喻：开关灯**

*   **场景**：一个房间有多个开关，控制不同的灯。
*   **组合逻辑控制器**：就像一个**复杂的开关面板**，每个开关（微命令）都直接连到特定的灯（部件）。你按一个组合（比如“执行周期”+“T1”+“ADD指令”），对应的灯（`R1→A/B`, `R2→A/B`）瞬间亮起。开关和灯的连接是**硬连线**的。
*   **微程序控制器**：就像一个**智能语音助手**。你说“执行加法的第一步”（当前状态），它先查一下它的“操作手册”（CM），找到对应的指令是“打开R1和R2的开关”，然后它再发出指令去打开那两个开关。这个“查手册”的过程就是“读取微指令”。

---

### **为什么这个区别如此重要？**

这个根本区别导致了两种控制器在**设计、性能、灵活性**上的巨大差异：

*   **速度**：组合逻辑“即时计算”，没有查表开销，**更快**。微程序需要访问存储器，有延迟，**较慢**。
*   **灵活性**：组合逻辑的“电路”一旦做好就**无法改变**。要改指令，就得重新设计电路。微程序的“手册”可以**重新编写**（通过改变ROM内容），非常灵活。
*   **设计复杂度**：组合逻辑对于复杂指令集，电路会**极其复杂、难以设计和调试**。微程序的设计就像写程序，**规整、易于理解和维护**。

---

**结论**：
您总结的“**读取 vs. 即时计算**”完美地抓住了两种控制器的**灵魂**。这不仅仅是实现方式的不同，更是两种**工程哲学**的体现：一种是追求极致性能的“硬核”硬件设计，另一种是追求高可维护性的“软化”硬件设计。理解了这一点，就真正理解了CPU控制器的核心奥秘。