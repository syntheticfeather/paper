## 📚 第四章(01) 语法分析 - 文法语法 概念总结

### 🎯 核心目标
理解**如何用形式化方法描述程序的语法结构**

---

### 1. 文法（Grammar）的基本概念

#### 什么是文法？
- **形式化规则**：描述语言语法结构的精确规则
- **类比**：就像英语的语法书，规定句子的组成方式

#### 文法的四元组表示
```
G = (V_T, V_N, S, P)
```
- **V_T**：终结符集合（单词，不可再分）
  - 如：`if`, `while`, `(`, `)`, `+`, `id`
- **V_N**：非终结符集合（语法变量，可再分）  
  - 如：`<stmt>`, `<expr>`, `<program>`
- **S**：开始符号（整个程序的起点）
- **P**：产生式集合（语法规则）

#### 产生式（Production）
- **形式**：`左部 → 右部`
- **左部**：必须包含至少一个非终结符
- **右部**：由终结符和/或非终结符组成的序列
- **约定**：非终结符是大写字母，开始符号仅有一个，并且规定为第一个产生式的左部

**例子**：
```
<句子> → <主语><谓语><宾语>
<主语> → <名词> | <代词>
<名词> → "book" | "computer"
```

---

### 2. 文法的分类（乔姆斯基体系）

| 类型 | 产生式形式 | 描述能力 | 对应自动机 |
|------|------------|----------|------------|
| **0型** | α → β（无限制） | 最强 | 图灵机 |
| **1型** | αAβ → αγβ（上下文有关） | 强 | 线性界限自动机 |
| **2型** | A → γ（上下文无关） | 中等 | 下推自动机 |
| **3型** | A → aB 或 A → a（正规） | 最弱 | 有限自动机 |

**关键洞察**：编程语言主要用**2型文法（上下文无关文法）** 描述

---

### 3. 推导（Derivation）

#### 直接推导
- 用产生式的右部替换左部
- 记作：`αAβ ⇒ αγβ`（当 `A → γ` 是一个产生式）

#### 推导序列
```
α₁ ⇒ α₂ ⇒ ... ⇒ αₙ
```
称 α₁ 可以推导出 αₙ

#### 最左推导 vs 最右推导
- **最左推导**：总是替换最左边的非终结符
- **最右推导（规范推导）**：总是替换最右边的非终结符

**例子**（文法：`E → E+E | E*E | (E) | i`）：
```
最左推导：E ⇒ E+E ⇒ i+E ⇒ i+E*E ⇒ i+i*E ⇒ i+i*i
最右推导：E ⇒ E*E ⇒ E*i ⇒ E+E*i ⇒ E+i*i ⇒ i+i*i
```

---

### 4. 句型、句子和语言

#### 相关概念
- **句型**：从开始符号推导出的任何字符串 `α`（`α ∈ (V_T ∪ V_N)*`）
- **句子**：仅包含终结符的句型（`α ∈ V_T*`）
- **语言**：所有句子的集合 `L(G) = {w | S ⇒* w, w ∈ V_T*}`

#### 例子
对于文法：`S → aSb | ab`
- 句型：`S`, `aSb`, `aaSbb`, `aabb`等
- 句子：`ab`, `aabb`, `aaabbb`等
- 语言：`L(G) = {aⁿbⁿ | n ≥ 1}`

---

### 5. 语法树（Parse Tree）

#### 什么是语法树？
- 推导过程的图形化表示
- 显示句子的层次结构

#### 语法树的特点
- **根节点**：开始符号
- **内部节点**：非终结符
- **叶子节点**：终结符
- **有序性**：子节点从左到右对应产生式右部

#### 例子：`i+i*i` 的语法树
```
    E
   /|\
  E + E
  |   |\
  i   E * E
      |   |
      i   i
```

---

### 6. 二义性（Ambiguity）

#### 文法的二义性
- **定义**：如果存在某个句子对应**两棵不同的语法树**
- **例子**：`if x then if y then z else w`
  - else 可以与第一个if或第二个if匹配

#### 语言的二义性
- **定义**：如果对某种语言**不存在无二义的文法**

#### 二义性的危害
- 导致程序含义不明确
- 编译器无法确定正确的语法结构

#### 解决二义性的方法
1. **改写文法**：引入新的非终结符明确优先级和结合性
2. **附加规则**：如"else与最近的if匹配"

**例子**：消除表达式文法的二义性
```bnf
# 二义文法
E → E+E | E*E | (E) | i

# 无二义文法  
E → E+T | T
T → T*F | F
F → (E) | i
```

---

### 7. 关键理论洞察

#### 文法的重要性
- **有限规则描述无穷语言**：用有限的产生式描述无限多的合法程序
- **形式化基础**：为语法分析提供数学基础

#### 文法等价
- 两个文法G和G'，如果`L(G) = L(G')`，则称它们等价
- 同一个语言可能有多个等价的文法

#### 语法树的价值
- **不同推导的共性抽象**：多个推导可能对应同一棵语法树
- **结构清晰**：直观显示程序的层次结构

---

## 💡 学习要点总结

1. **文法**是描述语法规则的形式化工具
2. **推导**展示如何从开始符号生成句子
3. **语法树**是推导的可视化表示
4. **二义性**是文法设计中要避免的问题
5. **上下文无关文法**足够描述大多数编程语言的语法
